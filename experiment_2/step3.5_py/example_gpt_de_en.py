# -*- coding: utf-8 -*-
"""gpt-de-en_mt_eval_pipeline.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1JR2s6hUdpWJ4PQ4PbzlsKj4d1bvZ5bIg
"""

#step1

!python3 mt_eval_pipeline.py \
  --step 1 \
  --score-file /content/de-en.wmt.seg.score \
  --sys-info-output system_info.json

#step2

!python3 mt_eval_pipeline.py \
  --step 2 \
  --sys-info system_info.json \
  --merged-output merged_translations.txt

#step3

!python3 mt_eval_pipeline.py \
  --step 3 \
  --sys-info system_info.json \
  --merged-trans merged_translations.txt \
  --source-jsonl /content/de-en.jsonl \
  --aligned-output aligned_output.jsonl

!pip install -U sentence-transformers tqdm

# Step 3.5: Compute Semantic Similarity Scores

!python3 semantic_similarity_evaluator.py \
  --input aligned_output.jsonl \
  --output /content/enhanced_output.jsonl \
  --model all-mpnet-base-v2

#step4

!python3 mt_eval_pipeline.py \
  --step 4 \
  --enhanced-jsonl /content/enhanced_output.jsonl/aligned_output_scored.jsonl \
  --original-score /content/de-en.wmt.seg.score \
  --new-score-output output.wmt.seg.score

# Commented out IPython magic to ensure Python compatibility.
# Step 5.1: Install mt-metrics-eval (WMT evaluation framework)

## Clone the official mt-metrics-eval repository
!git clone https://github.com/google-research/mt-metrics-eval.git

## Change into the repository directory
# %cd mt-metrics-eval

## Install the package locally
!pip install .

# Step 5.2: Download mt-metrics-eval resources (~2GB)

# Run the mtme module's download function to fetch required data
!python3 -m mt_metrics_eval.mtme --download

# Step 5.3.1: Evaluate segment-level correlations for the current language pair

# Compute Kendall's tau correlation at segment level
!python3 -m mt_metrics_eval.mtme -t wmt22 -l de-en --matrix \
  --matrix_level seg --matrix_corr kendall --k_block 5

# Step 5.3.2

# Compute Pearson correlation at segment level
!python3 -m mt_metrics_eval.mtme -t wmt22 -l de-en --matrix \
  --matrix_level seg --matrix_corr pearson --k_block 5

# Step 5.3.2

# Compute Spearman correlation at segment level
!python3 -m mt_metrics_eval.mtme -t wmt22 -l de-en --matrix \
  --matrix_level seg --matrix_corr spearman --k_block 5

#step5.4
!python3 -m mt_metrics_eval.mtme \
  -t wmt22 -l de-en \
  -i /content/output.wmt.seg.score